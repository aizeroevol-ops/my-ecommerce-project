(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=i(t);fetch(t.href,o)}})();document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("products-list"),c=document.getElementById("add-product-form"),i=void 0,n=void 0;console.log("DEBUG: SUPABASE_URL is",i),console.log("DEBUG: SUPABASE_ANON_KEY is",n);async function t(){try{if(!i||!n){console.error("Supabase URL or Anon Key is missing. Please check your Netlify environment variables."),a.innerHTML="<li>加载商品失败：配置错误。</li>";return}const r=await fetch(`${i}/rest/v1/products?select=*`,{headers:{apikey:n}});if(!r.ok){const s=await r.json();throw new Error(`获取商品失败：${r.status} - ${s.message||r.statusText}`)}const e=await r.json();o(e)}catch(r){console.error("无法获取商品:",r),a.innerHTML=`<li>加载商品失败：${r.message||"未知错误"}。</li>`}}function o(r){if(a.innerHTML="",r.length===0){a.innerHTML="<li>当前没有商品。</li>";return}r.forEach(e=>{const s=document.createElement("li");s.innerHTML=`
        <h3>${e.name}</h3>
        <p><strong>描述(英文):</strong> ${e.description_en||"无"}</p>
        <p><strong>描述(中文):</strong> ${e.description_zh||"无"}</p>
        <p><strong>描述(阿拉伯语):</strong> ${e.description_ar||"无"}</p>
        <p><strong>价格:</strong> $${e.price?e.price.toFixed(2):"N/A"}</p>
        ${e.image_url?`<img src="${e.image_url}" alt="${e.name}" style="max-width:100px; max-height:100px;">`:""}
        <button class="delete-btn" data-id="${e.id}">删除</button>
      `,a.appendChild(s)}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",async s=>{const l=s.target.dataset.id;confirm(`确定要删除商品 ID: ${l} 吗？`)&&(await u(l),t())})})}async function d(r){try{if(!i||!n)throw new Error("Supabase URL or Anon Key is missing. Cannot add product.");const e=await fetch(`${i}/rest/v1/products`,{method:"POST",headers:{"Content-Type":"application/json",apikey:n},body:JSON.stringify(r)});if(!e.ok){const s=await e.json();throw new Error(`添加商品失败：${e.status} - ${s.message||e.statusText}`)}console.log("商品添加成功！"),c.reset(),t()}catch(e){console.error("无法添加商品:",e),alert("添加商品失败："+(e.message||"未知错误"))}}async function u(r){try{if(!i||!n)throw new Error("Supabase URL or Anon Key is missing. Cannot delete product.");const e=await fetch(`${i}/rest/v1/products?id=eq.${r}`,{method:"DELETE",headers:{apikey:n}});if(!e.ok){const s=await e.json();throw new Error(`删除商品失败：${e.status} - ${s.message||e.statusText}`)}console.log(`商品 ID: ${r} 删除成功！`)}catch(e){console.error("无法删除商品:",e),alert("删除商品失败："+(e.message||"未知错误"))}}c.addEventListener("submit",async r=>{r.preventDefault();const e={name:document.getElementById("product-name").value,description_en:document.getElementById("product-desc-en").value,description_zh:document.getElementById("product-desc-zh").value,description_ar:document.getElementById("product-desc-ar").value,price:parseFloat(document.getElementById("product-price").value),image_url:document.getElementById("product-image").value};if(!e.name||isNaN(e.price)){alert("请输入商品名称和有效价格。");return}await d(e)}),t()});
